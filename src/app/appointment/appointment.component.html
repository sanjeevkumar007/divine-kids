<section class="appointments-section" id="appointments">
  <header class="appointments-head">
    <h2 class="appointments-title">
      <span class="appointments-accent-icon" aria-hidden="true">ðŸ©º</span>
      Book an Appointment
    </h2>
    <p class="appointments-sub">
      Schedule a consultation with our specialists. Provide a few details and we will confirm shortly.
    </p>
  </header>

  <div class="appointments-layout">
    <!-- Doctor Selector -->
    <aside class="doctor-panel" aria-label="Available doctors">
      <h3 class="doctor-panel__title">Select Doctor</h3>
      <ul class="doctor-list">
        <li>
          <button type="button"
                  class="doctor-card"
                  [class.active]="form['doctorName']==='Dr. Mohd Yoosuf'"
                  (click)="selectDoctor('Dr. Mohd Yoosuf')">
            <figure class="doctor-card__media">
              <img src="../../assets/images/logo2.png" alt="Dr. Mohd Yoosuf">
            </figure>
            <div class="doctor-card__body">
              <h4 class="doctor-card__name">Dr. Mohd Yoosuf</h4>
              <p class="doctor-card__spec">Pediatric Neuro Rehab</p>
              <p class="doctor-card__meta">Exp: 25+ yrs</p>
            </div>
            <span class="doctor-card__check" aria-hidden="true">âœ“</span>
          </button>
        </li>
        <li>
          <button type="button"
                  class="doctor-card"
                  [class.active]="form['doctorName']==='Dr. Shraddha'"
                  (click)="selectDoctor('Dr. Shraddha')">
            <figure class="doctor-card__media">
              <img src="../../assets/images/logo2.png" alt="Dr. Shraddha">
            </figure>
            <div class="doctor-card__body">
              <h4 class="doctor-card__name">Dr. Shraddha</h4>
              <p class="doctor-card__spec">Developmental Therapy</p>
              <p class="doctor-card__meta">Exp: 2 yrs</p>
            </div>
            <span class="doctor-card__check" aria-hidden="true">âœ“</span>
          </button>
        </li>
      </ul>
      <p class="doctor-hint">Tap to choose a doctor</p>
    </aside>

    <!-- Form -->
    <form class="appointment-form"
          #apptForm="ngForm"
          (ngSubmit)="submitRequest(apptForm)"
          novalidate
          aria-labelledby="appointmentsFormTitle">

      <h3 id="appointmentsFormTitle" class="form-title">Appointment Details</h3>

      <div class="form-grid">
        <!-- Parent Name -->
        <div class="form-field">
          <label for="parentName">Parent / Guardian Name</label>
          <input id="parentName"
                 name="parentName"
                 type="text"
                 required
                 minlength="2"
                 [(ngModel)]="form.parentName"
                 #parentName="ngModel" />
          <div class="field-error" *ngIf="(apptForm.submitted || parentName.touched) && parentName.invalid">
            <small *ngIf="parentName.hasError('required')">Required</small>
            <small *ngIf="parentName.hasError('minlength')">Too short</small>
          </div>
        </div>

        <!-- Child Name -->
        <div class="form-field">
          <label for="childName">Child Name</label>
          <input id="childName"
                 name="childName"
                 type="text"
                 required
                 [(ngModel)]="form.childName"
                 #childName="ngModel" />
          <div class="field-error" *ngIf="(apptForm.submitted || childName.touched) && childName.invalid">
            <small *ngIf="childName.hasError('required')">Required</small>
          </div>
        </div>

        <!-- Child Age -->
        <div class="form-field">
          <label for="childAge">Child Age (months / years)</label>
          <input id="childAge"
                 name="childAge"
                 type="number"
                 min="0"
                 required
                 [(ngModel)]="form.childAge"
                 #childAge="ngModel" />
          <div class="field-error" *ngIf="(apptForm.submitted || childAge.touched) && childAge.invalid">
            <small *ngIf="childAge.hasError('required')">Required</small>
          </div>
        </div>

        <!-- Condition -->
        <div class="form-field">
          <label for="condition">Primary Concern</label>
          <select id="condition"
                  name="condition"
                  required
                  [(ngModel)]="form.condition"
                  #condition="ngModel">
            <option value="" disabled>Select...</option>
            <option>High Risk Infant Followâ€‘up</option>
            <option>Autism / ASD Screening</option>
            <option>Speech / Communication Delay</option>
            <option>Sensory Processing Issue</option>
            <option>Motor / Developmental Delay</option>
            <option>Feeding / Oral Issues</option>
          </select>
          <div class="field-error" *ngIf="(apptForm.submitted || condition.touched) && condition.invalid">
            <small *ngIf="condition.hasError('required')">Required</small>
          </div>
        </div>

        <!-- Date -->
        <div class="form-field">
          <label for="preferredDate">Preferred Date</label>
          <input id="preferredDate"
                 name="preferredDate"
                 type="date"
                 required
                 [(ngModel)]="form.preferredDate"
                 #preferredDate="ngModel" />
          <div class="field-error" *ngIf="(apptForm.submitted || preferredDate.touched) && preferredDate.invalid">
            <small *ngIf="preferredDate.hasError('required')">Required</small>
          </div>
        </div>

        <!-- Time -->
        <div class="form-field">
          <label for="preferredTime">Preferred Time</label>
          <input id="preferredTime"
                 name="preferredTime"
                 type="time"
                 required
                 [(ngModel)]="form.preferredTime"
                 #preferredTime="ngModel" />
          <div class="field-error" *ngIf="(apptForm.submitted || preferredTime.touched) && preferredTime.invalid">
            <small *ngIf="preferredTime.hasError('required')">Required</small>
          </div>
        </div>

        <!-- Session Mode -->
        <div class="form-field">
          <label for="sessionMode">Session Mode</label>
          <select id="sessionMode"
                  name="sessionMode"
                  required
                  [(ngModel)]="form.sessionMode"
                  #sessionMode="ngModel">
            <option value="" disabled>Select...</option>
            <option>Inâ€‘Clinic</option>
            <option>Virtual (Video)</option>
            <option>Home Visit (If Eligible)</option>
          </select>
          <div class="field-error" *ngIf="(apptForm.submitted || sessionMode.touched) && sessionMode.invalid">
            <small *ngIf="sessionMode.hasError('required')">Required</small>
          </div>
        </div>

        <!-- Email -->
        <div class="form-field">
          <label for="contactEmail">Email</label>
          <input id="contactEmail"
                 name="contactEmail"
                 type="email"
                 required
                 [(ngModel)]="form.contactEmail"
                 #contactEmail="ngModel" />
          <div class="field-error" *ngIf="(apptForm.submitted || contactEmail.touched) && contactEmail.invalid">
            <small *ngIf="contactEmail.hasError('required')">Required</small>
            <small *ngIf="contactEmail.hasError('email')">Invalid email</small>
          </div>
        </div>

        <!-- Phone -->
        <div class="form-field">
          <label for="contactPhone">Phone</label>
          <input id="contactPhone"
                 name="contactPhone"
                 type="tel"
                 pattern="^[0-9+ ()-]{8,}$"
                 required
                 [(ngModel)]="form.contactPhone"
                 #contactPhone="ngModel" />
          <div class="field-error" *ngIf="(apptForm.submitted || contactPhone.touched) && contactPhone.invalid">
            <small *ngIf="contactPhone.hasError('required')">Required</small>
            <small *ngIf="contactPhone.hasError('pattern')">Invalid format</small>
          </div>
        </div>

        <!-- Notes -->
        <div class="form-field span-2">
          <label for="notes">Additional Notes</label>
          <textarea id="notes"
                    name="notes"
                    rows="4"
                    [(ngModel)]="form.notes"></textarea>
        </div>

        <!-- File -->
        <div class="form-field span-2 attach-field">
          <label for="reports">Upload Reports (optional)</label>
          <input id="reports"
                 name="reports"
                 type="file"
                 (change)="onReportsSelected($event)"
                 accept=".pdf,.jpg,.png" />
          <small>Max 5MB. PDF / JPG / PNG.</small>
        </div>
      </div>

      <div class="form-actions">
        <button type="reset" class="btn btn-warning" [disabled]="submitting" style="margin-right:10px;">Reset</button>
        <button type="submit" class="btn btn-dark" >
          <!--<button type="submit" class="btn primary" [disabled]="submitting || apptForm.invalid">-->
            <span *ngIf="!submitting">Submit Request â–¸</span>
            <span *ngIf="submitting">Submittingâ€¦</span>
          </button>
</div>

      <p class="privacy-note">
        By submitting you consent to secure processing of provided health information for scheduling purposes only.
      </p>

      <div class="form-messages" *ngIf="submitSuccess || submitError">
        <p *ngIf="submitSuccess" class="msg success">Request submitted successfully. We will contact you soon.</p>
        <p *ngIf="submitError" class="msg error">{{ submitError }}</p>
      </div>
    </form>
  </div>
</section>
